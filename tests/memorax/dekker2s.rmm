forbidden
CS CS

data
  flag0 = * : [0:1]
  flag1 = * : [0:1]
  turn  = * : [0:1]

process
registers
  $flag = * : [0:1]
  $turn = * : [0:1]
text
  L0: locked write: flag0 := 1;
  L1: read: $flag := flag1;
      if $flag = 1 then {
        read: $turn := turn;
        if $turn != 0 then {
          write: flag0 := 0;
          while $turn != 0 do { 
            nop
          };
          locked write: flag0 := 1
        };
	goto L1
      };
  CS: 
      write: turn := 1;
      write: flag0 := 0;
      goto L0

process
registers
  $flag = * : [0:1]
  $turn = * : [0:1]
text
  L0: locked write: flag1 := 1;
  L1: read: $flag := flag0;
      if $flag = 1 then {
        read: $turn := turn;
        if $turn != 1 then {
          write: flag1 := 0;
          while $turn != 1 do { 
            nop
          };
          locked write: flag1 := 1
        };
	goto L1
      };
      goto CS;
  CS:
      write: turn := 0;
      write: flag1 := 0;
      goto L0
