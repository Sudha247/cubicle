
(* Ticker spinlock algorithm *)

type loc = L1 | L2 | L3 | L4

(* Program counters *)
array PC[proc] : loc

(* Local variables (registers) *)
array R[proc] : int

(* Global variables *)
weak var Head : int
weak var Tail : int


init (i) { PC[i] = L1 && Head = 0 && Tail = 0 }

unsafe (i j) { PC[i] = L4 && PC[j] = L4 }


transition t1([i])
requires { PC[i] = L1 }
{ PC[i] := L2; R[i] := Tail }

transition t2([i])
requires { PC[i] = L2 && Tail = R[i] }
{ PC[i] := L3; Tail := R[i] + 1 }

transition t3([i])
requires { PC[i] = L3 && Head = R[i] }
{ PC[i] := L4; }

transition t4([i])
requires { PC[i] = L4 }
{ PC[i] := L1; Head := R[i] + 1 }
