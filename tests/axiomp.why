
type pc = L1 | L2 | End

logic PC : int -> pc
logic R1 : int
logic R2 : int

logic p0 : int
logic p1 : int
logic p2 : int
logic p3 : int
logic p4 : int
logic p5 : int
logic p6 : int
logic p7 : int
logic p8 : int
logic p9 : int
logic p10 : int

type weak_var = _VX | _VY
type direction = _R | _W
type params = { _p1 : int }
type valtype = { _int : int; _bool : bool }
type event = { dir : direction; loc : weak_var; par : params; val : valtype }

logic e : int, int -> event
logic po : int, int, int, int -> prop
logic rf : int, int, int, int -> prop
logic co : int, int, int, int -> prop
logic fence : int, int, int, int -> prop

axiom rf :
  forall p1, p2, e1, e2 : int [rf(p1,e1,p2,e2)].
  rf(p1, e1, p2, e2)
  -> e(p1, e1).val = e(p2, e2).val and e(p1, e1).par = e(p2, e2).par

logic po_loc : int, int, int, int -> prop
axiom po_loc :
  forall p1, e1, p2, e2 : int [po(p1,e1,p2,e2)].
  po(p1, e1, p2, e2) and e(p1, e1).loc = e(p2, e2).loc
  -> po_loc(p1, e1, p2, e2)

logic rfe : int, int, int, int -> prop
axiom rfe :
  forall p1, p2, e1, e2 : int [rf(p1,e1,p2,e2)].
  rf(p1, e1, p2, e2) and p1 <> p2
  -> rfe(p1, e1, p2, e2)

logic fr : int, int, int, int -> prop
axiom fr :
  forall pr, pw1, pw2, r, w1, w2 : int [rf(pw1,w1,pr,r),co(pw1,w1,pw2,w2)].
  rf(pw1, w1, pr, r) and co(pw1, w1, pw2, w2)
  -> fr(pr, r, pw2, w2)

logic com : int, int, int, int -> prop
axiom com :
  forall p1, p2, e1, e2 : int [co(p1,e1,p2,e2)|rf(p1,e1,p2,e2)|fr(p1,e1,p2,e2)].
  co(p1, e1, p2, e2) or rf(p1, e1, p2, e2) or fr(p1, e1, p2, e2)
  -> com(p1, e1, p2, e2)

logic ppo : int, int, int, int -> prop
axiom ppo_tso :
  forall p1, p2, e1, e2 : int [po(p1,e1,p2,e2)].
  po(p1, e1, p2, e2) and not (e(p1, e1).dir = _W and e(p2, e2).dir = _R)
  -> ppo(p1, e1, p2, e2)

logic propg : int, int, int, int -> prop
axiom propg_tso :
  forall p1, p2, e1, e2 : int [ppo(p1,e1,p2,e2)|fence(p1,e1,p2,e2)|rfe(p1,e1,p2,e2)|fr(p1,e1,p2,e2)].
  ppo(p1, e1, p2, e2) or fence(p1, e1, p2, e2) or rfe(p1, e1, p2, e2) or fr(p1, e1, p2, e2)
  -> propg(p1, e1, p2, e2)

logic po_loc_U_com : int, int, int, int -> prop
axiom po_loc_U_com :
  forall p1, p2, e1, e2 : int [po_loc_U_com(p1,e1,p2,e2)].
  po_loc(p1, e1, p2, e2) or com(p1, e1, p2, e2) -> po_loc_U_com(p1, e1, p2, e2)
axiom po_loc_U_com_t :
  forall p1, p2, p3, e1, e2, e3 : int [po_loc_U_com(p1,e1,p2,e2),po_loc_U_com(p2,e2,p2,e3)].
  po_loc_U_com(p1, e1, p2, e2) and po_loc_U_com(p2, e2, p3, e3) -> po_loc_U_com(p1, e1, p3, e3)

logic co_U_prop : int, int, int, int -> prop
axiom co_U_prop :
  forall p1, p2, e1, e2 : int [co(p1,e1,p2,e2)|propg(p1,e1,p2,e2)].
  co(p1, e1, p2, e2) or propg(p1, e1, p2, e2) -> co_U_prop(p1, e1, p2, e2)
axiom co_U_prop_t :
  forall p1, p2, p3, e1, e2, e3 : int [co_U_prop(p1,e1,p2,e2),co_U_prop(p2,e2,p3,e3)].
  co_U_prop(p1, e1, p2, e2) and co_U_prop(p2, e2, p3, e3) -> co_U_prop(p1, e1, p3, e3)

logic e1 : int
logic e2 : int
logic e3 : int
logic e4 : int
logic e5 : int
logic e6 : int


goal g: true
 and (e1 <> e2) and (e1 <> e3) and (e1 <> e4) and (e1 <> e5) and (e1 <> e6) 
 and (e2 <> e3) and (e2 <> e4) and (e2 <> e5) and (e2 <> e6) 
 and (e3 <> e4) and (e3 <> e5) and (e3 <> e6) 
 and (e4 <> e5) and (e4 <> e6) 
 and (e5 <> e6)
 and (p0<>p1) and (p0<>p2) and (p1<>p2)
 and (PC(p1)=L1) and (PC(p2)=L1)

 (* Events *)
 and (e(p1,e1).loc=_VY) and (e(p1,e1).dir=_R) and (e(p1,e1).val._bool=false)
 and (e(p2,e2).loc=_VX) and (e(p2,e2).dir=_R) and (e(p2,e2).val._int=0)
 and (e(p2,e3).loc=_VY) and (e(p2,e3).dir=_W) and (e(p2,e3).val._bool=true)
 and (e(p1,e4).loc=_VX) and (e(p1,e4).dir=_W) and (e(p1,e4).val._int=1)
 and (e(p0,e5).loc=_VX) and (e(p0,e5).dir=_W) and (e(p0,e5).val._int=0)
 and (e(p0,e6).loc=_VY) and (e(p0,e6).dir=_W) and (e(p0,e6).val._bool=false)

 (* Relations *)
 and (po(p2,e3,p2,e2)=true) and (po(p1,e4,p1,e1)=true)
 and (fence(p2,e3,p2,e2)=true) and (fence(p1,e4,p1,e1)=true)
 and (co(p0,e6,p2,e3)=true) and (co(p0,e5,p1,e4)=true)
 and (rf(p0,e5,p2,e2)=true or rf(p1,e4,p2,e2)=true)
 and (rf(p0,e6,p1,e1)=true or rf(p2,e3,p1,e1)=true)

 (* Validity check *)
 and (co_U_prop(p0,e6,p0,e6)=false) and (po_loc_U_com(p0,e6,p0,e6)=false)
 and (co_U_prop(p0,e5,p0,e5)=false) and (po_loc_U_com(p0,e5,p0,e5)=false)
 and (co_U_prop(p1,e4,p1,e4)=false) and (po_loc_U_com(p1,e4,p1,e4)=false)
 and (co_U_prop(p2,e3,p2,e3)=false) and (po_loc_U_com(p2,e3,p2,e3)=false)
 and (co_U_prop(p2,e2,p2,e2)=false) and (po_loc_U_com(p2,e2,p2,e2)=false)
 and (co_U_prop(p1,e1,p1,e1)=false) and (po_loc_U_com(p1,e1,p1,e1)=false)
