<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Try Cubicle</title>

    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="navbar.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
  </head>

  <style>
    textarea { white-space:pre; }
  </style>

  <body>

    <header class="navbar navbar-static-top navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a href="/" class="navbar-brand">Cubicle</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a href="#overview">Overview</a>
            </li>
            <li>
              <a href="#download">Download</a>
            </li>
            <li class="active">
              <a href="#try">Try</a>
            </li>
            <li>
              <a href="#contact">Contact</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>

    <div class="container">

      <h1>Try
        Cubicle <small>version <span id="version">?</span></small></h1>

      <div class="row">

        <div class="form-group">
          <textarea id="input" class="form-control"
                    style="font-family:monospace" rows="20">
            <!-- type req = Empty | Reqs | Reqe -->
            <!-- type cstate = Invalid | Shared | Exclusive -->


            <!-- var Exgntd : bool -->
            <!-- var Curcmd : req -->
            <!-- var Curptr : proc -->

            <!-- array Cache[proc] : cstate -->
            <!-- array Shrset[proc] : bool -->
            <!-- array Chan[proc] : req -->

            <!-- init (z) { Cache[z] = Invalid && Shrset[z] = False && -->
            <!-- Exgntd = False && Curcmd = Empty && Chan[z]=Empty } -->

            <!-- unsafe (z1 z2) { Cache[z1] = Exclusive && Cache[z2] = Shared } -->
            
            <!-- transition send_shared (n) -->
            <!-- requires { Chan[n] = Empty && Cache[n] = Invalid } -->
            <!-- {  -->
            <!-- Chan[j] := case  -->
  	    <!-- | j = n : Reqs  -->
	    <!-- | _ : Chan[j]  -->
            <!-- } -->

            <!-- transition recv_shared (n) -->
            <!-- requires { Curcmd = Empty && Chan[n] = Reqs } -->
            <!-- { 	  -->
            <!-- Curcmd := Reqs;  -->
            <!-- Curptr := n ; -->
            <!-- Chan[j] := case  -->
  	    <!-- | j = n : Empty  -->
	    <!-- | _ : Chan[j]  -->
            <!-- } -->
            
            <!-- transition send_exclusive (n) -->
            <!-- requires { Chan[n] = Empty && Cache[n] <> Exclusive } -->
            <!--   {  -->
            <!--   Chan[j] := case  -->
  	    <!--   | j = n : Reqe  -->
	    <!--   | _ : Chan[j]  -->
            <!--   } -->

            <!--   transition recv_exclusive (n) -->
            <!--   requires { Curcmd = Empty && Chan[n] = Reqe } -->
            <!--   {  -->
            <!--   Curcmd := Reqe;  -->
            <!--   Curptr := n ; -->
            <!--   Chan[j] := case  -->
  	    <!--   | j = n : Empty  -->
	    <!--   | _ : Chan[j]  -->
            <!--   } -->
              
            <!--   transition inv_1 (n) -->
            <!--   requires { Shrset[n]=True  &&  Curcmd = Reqe } -->
            <!--   {  -->
            <!--   Exgntd := False; -->
            <!--   Cache[j] := case  -->
  	    <!--   | j = n : Invalid  -->
	    <!--   | _ : Cache[j] ; -->
            <!--   Shrset[j] := case -->
  	    <!--   | j= n : False  -->
	    <!--   | _ : Shrset[j]  -->
            <!--   } -->

            <!--   transition inv_2 (n) -->
            <!--   requires { Shrset[n]=True  && Curcmd = Reqs && Exgntd=True } -->
            <!--   {  -->
            <!--   Exgntd := False; -->
            <!--   Cache[j] := case -->
	    <!--   | j = n : Invalid  -->
	    <!--   | _ : Cache[j] ; -->
            <!--   Shrset[j] := case -->
  	    <!--   | j= n : False  -->
	    <!--   | _ : Shrset[j]  -->
            <!--   } -->
              
            <!--   transition gnt_shared (n) -->
            <!--   requires { Curptr = n && Curcmd = Reqs && Exgntd = False } -->
            <!--   {  -->
            <!--   Curcmd := Empty; -->
            <!--   Shrset[j] := case  -->
  	    <!--   | j = n : True  -->
	    <!--   | _ : Shrset[j] ; -->
            <!--   Cache[j] := case  -->
  	    <!--   | j = n : Shared  -->
	    <!--   | _ : Cache[j]  -->
            <!--   } -->

            <!--   transition gnt_exclusive (n) -->
            <!--   requires { Shrset[n] = False && Curcmd = Reqe && Exgntd = False &&  -->
	    <!--   Curptr = n && forall_other l. Shrset[l] = False } -->
            <!--   {  -->
            <!--   Curcmd := Empty;  -->
            <!--   Exgntd := True; -->
            <!--   Shrset[j] := case  -->
  	    <!--   | j = n : True  -->
	    <!--   | _ : Shrset[j] ; -->
            <!--   Cache[j] := case  -->
  	    <!--   | j = n : Exclusive  -->
	    <!--   | _ : Cache[j]  -->
            <!--   } -->

          </textarea>
        </div>

        <div class="form-group">
          <button id="run-cubicle" type="button" class="btn btn-primary
                                                        btn-lg">Display trace</button>

          <button id="clearbtn" type="button" class="btn btn-default
                                                     btn-lg">Clear</button>

          <span id="lblnbnodes" class="label label-default">0</span>
        </div>

        <pre id="output" class="prettyprint">
        </pre>
        
        <textarea id="output2"
                  style="font-family:monospace" rows="20"></textarea>
        <div id="debug-content-dynamic">
        </div>

      </div>
    </div>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <!-- <script src="input.js"></script> -->
    <script>
      var id = 0;
      function get_id () {
      id = id + 1;
      return (id.toString ())
      }
    </script>
    <script src="cubicle.js" async></script>

    <script type="text/javascript">
     // default example
     function handleFile(data) {
       jQuery("textarea#input").val(data);
     }

     $(document).ready(function(){
       jQuery.get('germanish3.cub',
                  handleFile,
                  'text');
     });
    </script>

  </body>
</html>
